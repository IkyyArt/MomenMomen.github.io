<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Momen Spesial - Kelola Kenangan Berharga</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* CSS tetap sama seperti sebelumnya */
      :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --accent: #e74c3c;
        --light: #ecf0f1;
        --dark: #2c3e50;
        --success: #27ae60;
        --warning: #f39c12;
        --danger: #c0392b;
        --purple: #9b59b6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--dark);
        overflow-x: hidden;
      }

      .navbar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 1rem 0;
      }

      .navbar-brand {
        font-weight: 700;
        color: var(--primary) !important;
        font-size: 1.2rem;
      }

      .hero-section {
        background: linear-gradient(
          135deg,
          var(--primary) 0%,
          var(--secondary) 100%
        );
        color: white;
        padding: 3rem 0;
        border-radius: 0 0 30px 30px;
        position: relative;
        overflow: hidden;
      }

      .hero-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,186.7C384,213,480,235,576,213.3C672,192,768,128,864,128C960,128,1056,192,1152,197.3C1248,203,1344,149,1392,122.7L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        background-size: cover;
        background-position: center;
      }

      .hero-title {
        font-weight: 800;
        margin-bottom: 1rem;
        font-size: 2.2rem;
      }

      .hero-subtitle {
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
        opacity: 0.9;
      }

      .stats-section {
        margin-top: -2rem;
        position: relative;
        z-index: 10;
      }

      .stats-card {
        background: white;
        border-radius: 15px;
        padding: 1.5rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
        margin-bottom: 1rem;
        border: 2px solid transparent;
      }

      .stats-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent);
      }

      .stats-number {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: 0.5rem;
        line-height: 1;
      }

      .stats-label {
        color: #6c757d;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .main-content {
        padding: 3rem 0;
      }

      .section-title {
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: var(--dark);
        font-size: 1.5rem;
      }

      /* Momen Besar Card */
      .momen-besar-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
        margin-bottom: 2rem;
        border: 2px solid var(--primary);
      }

      .momen-besar-header {
        padding: 1.5rem;
        background: rgba(44, 62, 80, 0.05);
        cursor: pointer;
        transition: background 0.3s;
        border-bottom: 2px solid var(--primary);
      }

      .momen-besar-header:hover {
        background: rgba(44, 62, 80, 0.1);
      }

      .momen-besar-title {
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 0.5rem;
        font-size: 1.3rem;
      }

      .momen-besar-meta {
        color: #6c757d;
        font-size: 0.9rem;
      }

      .momen-besar-content {
        padding: 1.5rem;
      }

      /* Kategori Card */
      .kategori-card {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1.5rem;
        border-left: 4px solid var(--secondary);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      }

      .kategori-header {
        cursor: pointer;
        margin-bottom: 1rem;
      }

      .kategori-title {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.25rem;
        font-size: 1.1rem;
      }

      .kategori-meta {
        color: #6c757d;
        font-size: 0.8rem;
      }

      /* Sub Momen Item */
      .sub-momen-item {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
      }

      .sub-momen-item:hover {
        transform: translateX(5px);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .sub-momen-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .sub-momen-info {
        flex: 1;
      }

      .sub-momen-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
      }

      .sub-momen-date {
        color: #6c757d;
        font-size: 0.8rem;
      }

      .sub-momen-actions {
        display: flex;
        gap: 0.5rem;
      }

      .btn {
        border-radius: 8px;
        padding: 0.5rem 1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        min-height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .btn-primary {
        background: var(--primary);
        border: none;
      }

      .btn-primary:hover {
        background: #2c3e50;
        transform: translateY(-2px);
      }

      .btn-success {
        background: var(--success);
        border: none;
      }

      .btn-warning {
        background: var(--warning);
        border: none;
      }

      .btn-light {
        background: white;
        border: 1px solid #dee2e6;
        color: var(--dark);
      }

      .btn-sm {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
        min-height: 32px;
      }

      .floating-btn {
        position: fixed;
        bottom: 1.5rem;
        right: 1.5rem;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--accent);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
        z-index: 1000;
        transition: all 0.3s ease;
        animation: pulse 2s infinite;
      }

      .floating-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(231, 76, 60, 0.7);
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
        }
        50% {
          box-shadow: 0 5px 30px rgba(231, 76, 60, 0.8);
        }
        100% {
          box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
        }
      }

      .empty-state {
        text-align: center;
        padding: 2.5rem 1rem;
        color: #6c757d;
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: #dee2e6;
      }

      .empty-state h3 {
        margin-bottom: 0.75rem;
        color: #6c757d;
        font-size: 1.25rem;
      }

      .modal-content {
        border-radius: 15px;
        border: none;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
      }

      .form-control,
      .form-select {
        border-radius: 8px;
        padding: 0.75rem;
        border: 1px solid #e0e0e0;
        transition: all 0.3s ease;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(44, 62, 80, 0.25);
      }

      .badge {
        font-size: 0.7rem;
        padding: 0.25rem 0.5rem;
      }

      .progress {
        height: 8px;
        margin: 0.5rem 0;
      }

      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        background-color: var(--primary);
        top: -10px;
        border-radius: 50%;
        animation: confetti-fall 5s linear forwards;
        z-index: 10000;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
          opacity: 0;
        }
      }

      /* People Tags */
      .people-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .person-tag {
        background: var(--primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .person-tag .remove-person {
        cursor: pointer;
        margin-left: 0.25rem;
      }

      /* People Management */
      .people-management {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .person-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem;
        border-bottom: 1px solid #e9ecef;
      }

      .person-item:last-child {
        border-bottom: none;
      }

      .person-info {
        flex: 1;
      }

      .person-name {
        font-weight: 500;
        margin-bottom: 0.1rem;
      }

      .person-type {
        font-size: 0.8rem;
        color: #6c757d;
      }

      /* Forum Section */
      .forum-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
      }

      .people-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: 1rem;
      }

      .person-card {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 1rem;
        width: calc(33.333% - 0.75rem);
        transition: all 0.3s ease;
      }

      .person-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
        .person-card {
          width: calc(50% - 0.75rem);
        }
      }

      @media (max-width: 576px) {
        .person-card {
          width: 100%;
        }
      }

      /* Tab Navigation */
      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 500;
        padding: 0.75rem 1.5rem;
      }

      .nav-tabs .nav-link.active {
        color: var(--primary);
        border-bottom: 3px solid var(--primary);
        background: transparent;
      }

      /* People Selection in Sub Momen */
      .people-selection {
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 0.5rem;
      }

      .person-checkbox {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-radius: 5px;
        transition: background 0.2s;
      }

      .person-checkbox:hover {
        background: #f8f9fa;
      }

      .person-checkbox input {
        margin-right: 0.5rem;
      }

      /* Image Upload Styles */
      .image-upload-container {
        border: 2px dashed #ddd;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        margin-bottom: 1rem;
        background: #f8f9fa;
      }

      .image-upload-container:hover {
        border-color: var(--primary);
        background: rgba(44, 62, 80, 0.05);
      }

      .image-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 10px;
        margin: 0.75rem auto;
        display: block;
        border: 2px solid var(--secondary);
      }

      .photo-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.75rem;
      }

      .photo-thumbnail {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
      }

      .photo-thumbnail:hover {
        transform: scale(1.1);
        border-color: var(--primary);
      }

      /* Edit Button Styles */
      .edit-btn {
        background: var(--warning);
        border: none;
        color: white;
      }

      .edit-btn:hover {
        background: #e67e22;
        transform: translateY(-2px);
      }

      @media (max-width: 576px) {
        .container {
          padding-left: 15px;
          padding-right: 15px;
        }
        .hero-title {
          font-size: 1.75rem;
        }
        .hero-subtitle {
          font-size: 0.9rem;
        }
        .stats-number {
          font-size: 1.75rem;
        }
        .section-title {
          font-size: 1.25rem;
        }
        .btn {
          width: 100%;
          margin-bottom: 0.5rem;
        }
        .btn-group .btn {
          width: auto;
          margin-bottom: 0;
        }
      }

      .hierarchy-indicator {
        margin-left: 1rem;
        color: #6c757d;
        font-size: 0.9rem;
      }

      .fade-in {
        opacity: 0;
        animation: fadeIn 0.5s ease forwards;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-mountain me-2"></i>Momen Spesial
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#moments">Momen</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#forum">Forum</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container text-center position-relative">
        <h1 class="hero-title">Kelola Momen Spesial Anda</h1>
        <p class="hero-subtitle">
          Atur pencapaian dan kenangan berharga dalam hidup Anda dengan sistem
          hierarki yang terstruktur
        </p>
        <button
          class="btn btn-light btn-lg"
          data-bs-toggle="modal"
          data-bs-target="#addMomenBesarModal"
        >
          <i class="fas fa-plus me-2"></i>Buat Momen Besar
        </button>
      </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
      <div class="container">
        <div class="row g-3">
          <div class="col-4">
            <div class="stats-card fade-in">
              <div class="stats-number" id="totalMomenBesar">0</div>
              <div class="stats-label">Momen Besar</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card fade-in" style="animation-delay: 0.1s">
              <div class="stats-number" id="totalKategori">0</div>
              <div class="stats-label">Kategori</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stats-card fade-in" style="animation-delay: 0.2s">
              <div class="stats-number" id="totalSubMomen">0</div>
              <div class="stats-label">Sub Momen</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main Content with Tabs -->
    <section class="main-content">
      <div class="container">
        <ul class="nav nav-tabs mb-4" id="mainTabs">
          <li class="nav-item">
            <a
              class="nav-link active"
              id="moments-tab"
              data-bs-toggle="tab"
              href="#moments"
              >Hierarki Momen Saya</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="forum-tab"
              data-bs-toggle="tab"
              href="#forum"
              >Forum - Kelola Orang</a
            >
          </li>
        </ul>

        <div class="tab-content">
          <!-- Moments Tab -->
          <div class="tab-pane fade show active" id="moments">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h2 class="section-title mb-0">Hierarki Momen Saya</h2>
            </div>

            <div id="momentsContainer">
              <!-- Momen items will be dynamically added here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
              <i class="fas fa-trophy"></i>
              <h3>Belum Ada Momen Besar</h3>
              <p>Mulai buat momen besar pertama Anda dan atur pencapaiannya!</p>
              <button
                class="btn btn-primary mt-3"
                data-bs-toggle="modal"
                data-bs-target="#addMomenBesarModal"
              >
                <i class="fas fa-plus me-2"></i>Buat Momen Besar Pertama
              </button>
            </div>
          </div>

          <!-- Forum Tab -->
          <div class="tab-pane fade" id="forum">
            <div class="forum-section">
              <h2 class="section-title">Forum - Kelola Orang</h2>
              <p class="text-muted mb-4">
                Kelola daftar orang yang akan dipilih saat membuat Sub Momen
              </p>

              <div class="people-management">
                <h6>Tambah Orang Baru</h6>
                <div class="input-group mb-3">
                  <input
                    type="text"
                    class="form-control"
                    id="personName"
                    placeholder="Nama orang"
                  />
                  <select class="form-select" id="personType">
                    <option value="family">Keluarga</option>
                    <option value="friend">Teman</option>
                    <option value="partner">Pacar/Pasangan</option>
                    <option value="colleague">Rekan Kerja</option>
                  </select>
                  <button
                    class="btn btn-primary"
                    type="button"
                    id="addPersonBtn"
                  >
                    <i class="fas fa-plus"></i> Tambah
                  </button>
                </div>
              </div>

              <div class="people-list" id="peopleListContainer">
                <!-- People list will be dynamically added here -->
              </div>

              <div id="emptyPeopleList" class="empty-state">
                <i class="fas fa-users"></i>
                <h3>Belum Ada Orang</h3>
                <p>
                  Tambahkan orang terdekat untuk memudahkan pembuatan Sub Momen
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer>
      <div class="container text-center">
        <p>
          &copy; 2023 Momen Spesial. Kelola setiap pencapaian berharga dalam
          hidup Anda!
        </p>
      </div>
    </footer>

    <!-- Floating Action Button -->
    <div
      class="floating-btn"
      data-bs-toggle="modal"
      data-bs-target="#addMomenBesarModal"
    >
      <i class="fas fa-plus"></i>
    </div>

    <!-- Add Momen Besar Modal -->
    <div class="modal fade" id="addMomenBesarModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="momenBesarModalTitle">
              Buat Momen Besar Baru
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addMomenBesarForm">
              <input type="hidden" id="momenBesarId" />
              <div class="mb-3">
                <label for="momenBesarName" class="form-label"
                  >Nama Momen Besar</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="momenBesarName"
                  placeholder="Contoh: Pencapaian Karir 2024"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="momenBesarDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="momenBesarDescription"
                  rows="3"
                  placeholder="Deskripsi tentang momen besar ini..."
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="saveMomenBesarBtn"
            >
              Simpan Momen Besar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Kategori Modal -->
    <div class="modal fade" id="addKategoriModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="kategoriModalTitle">Tambah Kategori</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addKategoriForm">
              <input type="hidden" id="kategoriMomenBesarId" />
              <input type="hidden" id="kategoriId" />
              <div class="mb-3">
                <label for="kategoriName" class="form-label"
                  >Nama Kategori</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="kategoriName"
                  placeholder="Contoh: Promosi Jabatan"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="kategoriDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="kategoriDescription"
                  rows="3"
                  placeholder="Deskripsi kategori..."
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveKategoriBtn">
              Simpan Kategori
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Sub Momen Modal -->
    <div class="modal fade" id="addSubMomenModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="subMomenModalTitle">
              Tambah Sub Momen
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addSubMomenForm">
              <input type="hidden" id="subMomenMomenBesarId" />
              <input type="hidden" id="subMomenKategoriId" />
              <input type="hidden" id="subMomenId" />
              <div class="mb-3">
                <label for="subMomenName" class="form-label"
                  >Nama Sub Momen</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="subMomenName"
                  placeholder="Contoh: Naik jadi Manager"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="subMomenDate" class="form-label"
                  >Tanggal Momen</label
                >
                <input
                  type="date"
                  class="form-control"
                  id="subMomenDate"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="subMomenDescription" class="form-label"
                  >Deskripsi (Opsional)</label
                >
                <textarea
                  class="form-control"
                  id="subMomenDescription"
                  rows="3"
                  placeholder="Deskripsi sub momen..."
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Orang yang Terlibat</label>
                <div class="people-tags" id="selectedPeopleTags"></div>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-primary mt-2"
                  onclick="openPeopleSelectionModal()"
                >
                  <i class="fas fa-plus me-1"></i>Pilih Orang
                </button>
              </div>
              <div class="mb-3">
                <label class="form-label">Foto Momen (Opsional)</label>
                <div class="image-upload-container" id="subMomenImageUpload">
                  <i class="fas fa-cloud-upload-alt fa-2x mb-3 text-muted"></i>
                  <p class="mb-2">Klik atau drag & drop untuk upload foto</p>
                  <small class="text-muted"
                    >Format: JPG, PNG, GIF (Max 2MB)</small
                  >
                  <input
                    type="file"
                    id="subMomenImages"
                    accept="image/*"
                    multiple
                    class="d-none"
                  />
                </div>
                <div id="subMomenImagesPreview" class="photo-gallery"></div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button type="button" class="btn btn-primary" id="saveSubMomenBtn">
              Simpan Sub Momen
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- People Selection Modal -->
    <div class="modal fade" id="peopleSelectionModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Pilih Orang yang Terlibat</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <div class="people-selection" id="peopleChecklist">
              <!-- People checklist will be dynamically added here -->
            </div>
            <div id="emptyPeopleState" class="text-center py-4 text-muted">
              <i class="fas fa-users fa-2x mb-3"></i>
              <p>Belum ada orang yang ditambahkan</p>
              <button
                type="button"
                class="btn btn-primary btn-sm"
                onclick="switchToForumTab()"
              >
                Tambah Orang Baru
              </button>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="confirmPeopleSelection"
            >
              Simpan Pilihan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Photo Modal - DIPERBAIKI: Tag penutup yang benar -->
    <div class="modal fade" id="photoModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Foto Momen</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <img id="modalPhoto" src="" alt="Foto Momen" class="img-fluid" />
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center p-5">
            <i
              class="fas fa-check-circle text-success mb-3"
              style="font-size: 4rem"
            ></i>
            <h3 class="mb-3">Berhasil!</h3>
            <p id="successMessage">Momen berhasil ditambahkan!</p>
            <button
              type="button"
              class="btn btn-primary mt-3"
              data-bs-dismiss="modal"
            >
              Tutup
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Data storage
      let momenBesarList =
        JSON.parse(localStorage.getItem("momenBesarList")) || [];
      let peopleList = JSON.parse(localStorage.getItem("peopleList")) || [];
      let currentSelectedPeople = [];
      let currentEditingSubMomen = null;
      let currentEditingMomenBesar = null;
      let currentEditingKategori = null;
      let currentSubMomenImages = [];

      // DOM Elements
      const momentsContainer = document.getElementById("momentsContainer");
      const emptyState = document.getElementById("emptyState");
      const totalMomenBesarEl = document.getElementById("totalMomenBesar");
      const totalKategoriEl = document.getElementById("totalKategori");
      const totalSubMomenEl = document.getElementById("totalSubMomen");
      const peopleListContainer = document.getElementById(
        "peopleListContainer"
      );
      const emptyPeopleList = document.getElementById("emptyPeopleList");

      // Initialize the app
      document.addEventListener("DOMContentLoaded", function () {
        renderMoments();
        updateStats();
        renderPeopleList();
        setupEventListeners();
        setupImageUpload();

        // Event delegation untuk elemen yang dibuat dinamis
        setupEventDelegation();
      });

      // Setup event delegation untuk elemen dinamis
      function setupEventDelegation() {
        document.addEventListener("click", function (e) {
          // Toggle momen besar details
          if (e.target.closest(".momen-besar-header")) {
            const header = e.target.closest(".momen-besar-header");
            const contentId = header.nextElementSibling.id;
            const momenBesarId = contentId.replace("momen-besar-content-", "");
            toggleMomenBesarDetails(parseInt(momenBesarId));
          }

          // Toggle kategori details
          if (e.target.closest(".kategori-header")) {
            const header = e.target.closest(".kategori-header");
            const contentId = header.nextElementSibling.id;
            const kategoriId = contentId.replace("kategori-content-", "");
            toggleKategoriDetails(parseInt(kategoriId));
          }
        });
      }

      // Setup event listeners
      function setupEventListeners() {
        // Save buttons
        document
          .getElementById("saveMomenBesarBtn")
          .addEventListener("click", saveMomenBesar);
        document
          .getElementById("saveKategoriBtn")
          .addEventListener("click", saveKategori);
        document
          .getElementById("saveSubMomenBtn")
          .addEventListener("click", saveSubMomen);
        document
          .getElementById("addPersonBtn")
          .addEventListener("click", addPerson);
        document
          .getElementById("confirmPeopleSelection")
          .addEventListener("click", confirmPeopleSelection);

        // Reset forms when modal is hidden
        document
          .getElementById("addMomenBesarModal")
          .addEventListener("hidden.bs.modal", resetMomenBesarForm);
        document
          .getElementById("addKategoriModal")
          .addEventListener("hidden.bs.modal", resetKategoriForm);
        document
          .getElementById("addSubMomenModal")
          .addEventListener("hidden.bs.modal", resetSubMomenForm);
      }

      // Setup image upload functionality
      function setupImageUpload() {
        const imageUpload = document.getElementById("subMomenImageUpload");
        const imageInput = document.getElementById("subMomenImages");

        if (imageUpload && imageInput) {
          imageUpload.addEventListener("click", function () {
            imageInput.click();
          });

          imageInput.addEventListener("change", function (e) {
            handleImagesUpload(e.target.files);
          });

          // Drag and drop functionality
          imageUpload.addEventListener("dragover", function (e) {
            e.preventDefault();
            imageUpload.style.borderColor = "var(--primary)";
            imageUpload.style.background = "rgba(44, 62, 80, 0.1)";
          });

          imageUpload.addEventListener("dragleave", function () {
            imageUpload.style.borderColor = "#ddd";
            imageUpload.style.background = "#f8f9fa";
          });

          imageUpload.addEventListener("drop", function (e) {
            e.preventDefault();
            imageUpload.style.borderColor = "#ddd";
            imageUpload.style.background = "#f8f9fa";
            handleImagesUpload(e.dataTransfer.files);
          });
        }
      }

      // Handle images upload
      function handleImagesUpload(files) {
        if (!files || files.length === 0) return;

        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (!file.type.startsWith("image/")) {
            alert("Silakan pilih file gambar yang valid!");
            continue;
          }

          if (file.size > 2 * 1024 * 1024) {
            alert("Ukuran file maksimal 2MB!");
            continue;
          }

          const reader = new FileReader();
          reader.onload = function (e) {
            currentSubMomenImages.push(e.target.result);
            renderSubMomenImagesPreview();
          };
          reader.readAsDataURL(file);
        }
      }

      // Render sub momen images preview
      function renderSubMomenImagesPreview() {
        const preview = document.getElementById("subMomenImagesPreview");
        preview.innerHTML = "";

        currentSubMomenImages.forEach((image, index) => {
          const img = document.createElement("img");
          img.src = image;
          img.className = "photo-thumbnail";
          img.onclick = function () {
            viewPhoto(image);
          };

          const removeBtn = document.createElement("button");
          removeBtn.className = "btn btn-sm btn-danger ms-1";
          removeBtn.innerHTML = '<i class="fas fa-times"></i>';
          removeBtn.onclick = function (e) {
            e.stopPropagation();
            currentSubMomenImages.splice(index, 1);
            renderSubMomenImagesPreview();
          };

          const container = document.createElement("div");
          container.className = "d-inline-block";
          container.appendChild(img);
          container.appendChild(removeBtn);
          preview.appendChild(container);
        });
      }

      // Save Momen Besar (Add or Edit)
      function saveMomenBesar() {
        const id = parseInt(document.getElementById("momenBesarId").value);
        const name = document.getElementById("momenBesarName").value.trim();
        const description = document
          .getElementById("momenBesarDescription")
          .value.trim();

        if (!name) {
          alert("Nama momen besar harus diisi!");
          return;
        }

        let momenBesar;
        if (currentEditingMomenBesar) {
          // Edit existing momen besar
          momenBesar = momenBesarList.find((m) => m.id === id);
          if (!momenBesar) return;

          momenBesar.name = name;
          momenBesar.description = description;
        } else {
          // Add new momen besar
          momenBesar = {
            id: Date.now(),
            name,
            description,
            categories: [],
            createdAt: new Date().toISOString(),
          };
          momenBesarList.push(momenBesar);
        }

        saveToLocalStorage();
        renderMoments();
        updateStats();

        // Show success
        showSuccess(
          currentEditingMomenBesar
            ? "Momen besar berhasil diperbarui!"
            : "Momen besar berhasil ditambahkan!"
        );
        resetMomenBesarForm();
        bootstrap.Modal.getInstance(
          document.getElementById("addMomenBesarModal")
        ).hide();
      }

      // Reset momen besar form
      function resetMomenBesarForm() {
        currentEditingMomenBesar = null;
        document.getElementById("momenBesarId").value = "";
        document.getElementById("addMomenBesarForm").reset();
        document.getElementById("momenBesarModalTitle").textContent =
          "Buat Momen Besar Baru";
      }

      // Edit Momen Besar
      function editMomenBesar(id) {
        const momenBesar = momenBesarList.find((m) => m.id === id);
        if (!momenBesar) return;

        // Set form values
        document.getElementById("momenBesarId").value = momenBesar.id;
        document.getElementById("momenBesarName").value = momenBesar.name;
        document.getElementById("momenBesarDescription").value =
          momenBesar.description || "";

        // Update modal title
        document.getElementById("momenBesarModalTitle").textContent =
          "Edit Momen Besar";
        currentEditingMomenBesar = momenBesar;

        // Show modal
        new bootstrap.Modal(
          document.getElementById("addMomenBesarModal")
        ).show();
      }

      // Save Kategori (Add or Edit)
      function saveKategori() {
        const momenBesarId = parseInt(
          document.getElementById("kategoriMomenBesarId").value
        );
        const kategoriId = parseInt(
          document.getElementById("kategoriId").value
        );
        const name = document.getElementById("kategoriName").value.trim();
        const description = document
          .getElementById("kategoriDescription")
          .value.trim();

        if (!name) {
          alert("Nama kategori harus diisi!");
          return;
        }

        const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
        if (!momenBesar) return;

        let kategori;
        if (currentEditingKategori) {
          // Edit existing kategori
          kategori = momenBesar.categories.find((c) => c.id === kategoriId);
          if (!kategori) return;

          kategori.name = name;
          kategori.description = description;
        } else {
          // Add new kategori
          kategori = {
            id: Date.now(),
            name,
            description,
            subMoments: [],
          };
          momenBesar.categories.push(kategori);
        }

        saveToLocalStorage();
        renderMoments();
        updateStats();

        // Show success
        showSuccess(
          currentEditingKategori
            ? "Kategori berhasil diperbarui!"
            : "Kategori berhasil ditambahkan!"
        );
        resetKategoriForm();
        bootstrap.Modal.getInstance(
          document.getElementById("addKategoriModal")
        ).hide();
      }

      // Reset kategori form
      function resetKategoriForm() {
        currentEditingKategori = null;
        document.getElementById("kategoriId").value = "";
        document.getElementById("addKategoriForm").reset();
        document.getElementById("kategoriModalTitle").textContent =
          "Tambah Kategori";
      }

      // Edit Kategori
      function editKategori(momenBesarId, kategoriId) {
        const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
        if (!momenBesar) return;

        const kategori = momenBesar.categories.find((c) => c.id === kategoriId);
        if (!kategori) return;

        // Set form values
        document.getElementById("kategoriMomenBesarId").value = momenBesarId;
        document.getElementById("kategoriId").value = kategoriId;
        document.getElementById("kategoriName").value = kategori.name;
        document.getElementById("kategoriDescription").value =
          kategori.description || "";

        // Update modal title
        document.getElementById("kategoriModalTitle").textContent =
          "Edit Kategori";
        currentEditingKategori = kategori;

        // Show modal
        new bootstrap.Modal(document.getElementById("addKategoriModal")).show();
      }

      // Save Sub Momen (Add or Edit)
      function saveSubMomen() {
        const momenBesarId = parseInt(
          document.getElementById("subMomenMomenBesarId").value
        );
        const kategoriId = parseInt(
          document.getElementById("subMomenKategoriId").value
        );
        const subMomenId = parseInt(
          document.getElementById("subMomenId").value
        );
        const name = document.getElementById("subMomenName").value.trim();
        const date = document.getElementById("subMomenDate").value;
        const description = document
          .getElementById("subMomenDescription")
          .value.trim();

        if (!name || !date) {
          alert("Nama dan tanggal sub momen harus diisi!");
          return;
        }

        const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
        if (!momenBesar) return;

        const kategori = momenBesar.categories.find((c) => c.id === kategoriId);
        if (!kategori) return;

        let subMomen;
        if (currentEditingSubMomen) {
          // Edit existing sub momen
          subMomen = kategori.subMoments.find((s) => s.id === subMomenId);
          if (!subMomen) return;

          subMomen.name = name;
          subMomen.date = date;
          subMomen.description = description;
          subMomen.people = [...currentSelectedPeople];
          subMomen.images = [...currentSubMomenImages];
        } else {
          // Add new sub momen
          subMomen = {
            id: Date.now(),
            name,
            date,
            description,
            people: [...currentSelectedPeople],
            images: [...currentSubMomenImages],
          };
          kategori.subMoments.push(subMomen);
        }

        saveToLocalStorage();
        renderMoments();
        updateStats();

        // Show success
        showSuccess(
          currentEditingSubMomen
            ? "Sub momen berhasil diperbarui!"
            : "Sub momen berhasil ditambahkan!"
        );
        resetSubMomenForm();
        bootstrap.Modal.getInstance(
          document.getElementById("addSubMomenModal")
        ).hide();
      }

      // Reset sub momen form
      function resetSubMomenForm() {
        currentEditingSubMomen = null;
        currentSelectedPeople = [];
        currentSubMomenImages = [];
        document.getElementById("subMomenId").value = "";
        document.getElementById("addSubMomenForm").reset();
        document.getElementById("selectedPeopleTags").innerHTML = "";
        document.getElementById("subMomenImagesPreview").innerHTML = "";
        document.getElementById("subMomenModalTitle").textContent =
          "Tambah Sub Momen";
      }

      // Edit Sub Momen
      function editSubMomen(momenBesarId, kategoriId, subMomenId) {
        const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
        if (!momenBesar) return;

        const kategori = momenBesar.categories.find((c) => c.id === kategoriId);
        if (!kategori) return;

        const subMomen = kategori.subMoments.find((s) => s.id === subMomenId);
        if (!subMomen) return;

        // Set form values
        document.getElementById("subMomenMomenBesarId").value = momenBesarId;
        document.getElementById("subMomenKategoriId").value = kategoriId;
        document.getElementById("subMomenId").value = subMomenId;
        document.getElementById("subMomenName").value = subMomen.name;
        document.getElementById("subMomenDate").value = subMomen.date;
        document.getElementById("subMomenDescription").value =
          subMomen.description || "";

        // Set people
        currentSelectedPeople = subMomen.people || [];
        renderSelectedPeopleTags();

        // Set images
        currentSubMomenImages = subMomen.images || [];
        renderSubMomenImagesPreview();

        // Update modal title
        document.getElementById("subMomenModalTitle").textContent =
          "Edit Sub Momen";
        currentEditingSubMomen = subMomen;

        // Show modal
        new bootstrap.Modal(document.getElementById("addSubMomenModal")).show();
      }

      // Delete functions
      function deleteMomenBesar(id) {
        if (confirm("Apakah Anda yakin ingin menghapus momen besar ini?")) {
          momenBesarList = momenBesarList.filter((m) => m.id !== id);
          saveToLocalStorage();
          renderMoments();
          updateStats();
        }
      }

      function deleteKategori(momenBesarId, kategoriId) {
        if (confirm("Apakah Anda yakin ingin menghapus kategori ini?")) {
          const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
          if (momenBesar) {
            momenBesar.categories = momenBesar.categories.filter(
              (c) => c.id !== kategoriId
            );
            saveToLocalStorage();
            renderMoments();
            updateStats();
          }
        }
      }

      function deleteSubMomen(momenBesarId, kategoriId, subMomenId) {
        if (confirm("Apakah Anda yakin ingin menghapus sub momen ini?")) {
          const momenBesar = momenBesarList.find((m) => m.id === momenBesarId);
          if (momenBesar) {
            const kategori = momenBesar.categories.find(
              (c) => c.id === kategoriId
            );
            if (kategori) {
              kategori.subMoments = kategori.subMoments.filter(
                (s) => s.id !== subMomenId
              );
              saveToLocalStorage();
              renderMoments();
              updateStats();
            }
          }
        }
      }

      // Toggle functions
      function toggleMomenBesarDetails(id) {
        const content = document.getElementById(`momen-besar-content-${id}`);
        const icon = document.getElementById(`momen-besar-icon-${id}`);
        if (content.style.display === "none") {
          content.style.display = "block";
          icon.className = "fas fa-chevron-up";
        } else {
          content.style.display = "none";
          icon.className = "fas fa-chevron-down";
        }
      }

      function toggleKategoriDetails(id) {
        const content = document.getElementById(`kategori-content-${id}`);
        const icon = document.getElementById(`kategori-icon-${id}`);
        if (content.style.display === "none") {
          content.style.display = "block";
          icon.className = "fas fa-chevron-up";
        } else {
          content.style.display = "none";
          icon.className = "fas fa-chevron-down";
        }
      }

      // Open modal functions
      function openAddKategoriModal(momenBesarId) {
        resetKategoriForm();
        document.getElementById("kategoriMomenBesarId").value = momenBesarId;
        new bootstrap.Modal(document.getElementById("addKategoriModal")).show();
      }

      function openAddSubMomenModal(momenBesarId, kategoriId) {
        resetSubMomenForm();
        document.getElementById("subMomenMomenBesarId").value = momenBesarId;
        document.getElementById("subMomenKategoriId").value = kategoriId;
        new bootstrap.Modal(document.getElementById("addSubMomenModal")).show();
      }

      // People management functions
      function addPerson() {
        const name = document.getElementById("personName").value.trim();
        const type = document.getElementById("personType").value;

        if (!name) {
          alert("Nama orang harus diisi!");
          return;
        }

        savePersonToStorage(name, type);
        document.getElementById("personName").value = "";
      }

      function savePersonToStorage(name, type) {
        const newPerson = {
          id: Date.now(),
          name,
          type,
          createdAt: new Date().toISOString(),
        };

        peopleList.push(newPerson);
        saveToLocalStorage();
        renderPeopleList();
        showSuccess("Orang berhasil ditambahkan!");
      }

      function deletePerson(id) {
        if (confirm("Apakah Anda yakin ingin menghapus orang ini?")) {
          peopleList = peopleList.filter((p) => p.id !== id);
          saveToLocalStorage();
          renderPeopleList();
        }
      }

      function renderPeopleList() {
        if (peopleList.length === 0) {
          peopleListContainer.style.display = "none";
          emptyPeopleList.style.display = "block";
        } else {
          peopleListContainer.style.display = "flex";
          emptyPeopleList.style.display = "none";
          peopleListContainer.innerHTML = "";

          peopleList.forEach((person) => {
            const personCard = document.createElement("div");
            personCard.className = "person-card";
            personCard.innerHTML = `
              <div class="person-info">
                <div class="person-name">${person.name}</div>
                <div class="person-type">${getPersonTypeLabel(
                  person.type
                )}</div>
              </div>
              <button class="btn btn-sm btn-outline-danger mt-2" onclick="deletePerson(${
                person.id
              })">
                <i class="fas fa-trash"></i> Hapus
              </button>
            `;
            peopleListContainer.appendChild(personCard);
          });
        }
      }

      function getPersonTypeLabel(type) {
        const labels = {
          family: "Keluarga",
          friend: "Teman",
          partner: "Pacar/Pasangan",
          colleague: "Rekan Kerja",
        };
        return labels[type] || type;
      }

      // People selection functions
      function openPeopleSelectionModal() {
        renderPeopleChecklist();
        new bootstrap.Modal(
          document.getElementById("peopleSelectionModal")
        ).show();
      }

      function renderPeopleChecklist() {
        const container = document.getElementById("peopleChecklist");
        const empty = document.getElementById("emptyPeopleState");

        if (peopleList.length === 0) {
          container.style.display = "none";
          empty.style.display = "block";
        } else {
          container.style.display = "block";
          empty.style.display = "none";
          container.innerHTML = "";

          peopleList.forEach((person) => {
            const isSelected = currentSelectedPeople.includes(person.id);
            const item = document.createElement("div");
            item.className = "person-checkbox";
            item.innerHTML = `
              <input class="form-check-input" type="checkbox" value="${
                person.id
              }" id="person-${person.id}" ${isSelected ? "checked" : ""}>
              <label class="form-check-label" for="person-${person.id}">
                ${
                  person.name
                } <span class="badge bg-secondary">${getPersonTypeLabel(
              person.type
            )}</span>
              </label>
            `;
            container.appendChild(item);
          });
        }
      }

      function confirmPeopleSelection() {
        const checkboxes = document.querySelectorAll(
          '#peopleChecklist input[type="checkbox"]:checked'
        );
        currentSelectedPeople = Array.from(checkboxes).map((cb) =>
          parseInt(cb.value)
        );
        renderSelectedPeopleTags();
        bootstrap.Modal.getInstance(
          document.getElementById("peopleSelectionModal")
        ).hide();
      }

      function renderSelectedPeopleTags() {
        const container = document.getElementById("selectedPeopleTags");
        container.innerHTML = "";

        currentSelectedPeople.forEach((personId) => {
          const person = peopleList.find((p) => p.id === personId);
          if (person) {
            const tag = document.createElement("span");
            tag.className = "person-tag";
            tag.innerHTML = `
              ${person.name}
              <span class="remove-person" onclick="removeSelectedPerson(${person.id})">
                <i class="fas fa-times"></i>
              </span>
            `;
            container.appendChild(tag);
          }
        });
      }

      function removeSelectedPerson(personId) {
        currentSelectedPeople = currentSelectedPeople.filter(
          (id) => id !== personId
        );
        renderSelectedPeopleTags();
      }

      // Switch to Forum tab
      function switchToForumTab() {
        bootstrap.Modal.getInstance(
          document.getElementById("peopleSelectionModal")
        ).hide();
        const forumTab = new bootstrap.Tab(
          document.getElementById("forum-tab")
        );
        forumTab.show();
      }

      // Photo functions
      function viewPhoto(photoSrc) {
        document.getElementById("modalPhoto").src = photoSrc;
        new bootstrap.Modal(document.getElementById("photoModal")).show();
      }

      // Render moments
      function renderMoments() {
        if (momenBesarList.length === 0) {
          momentsContainer.style.display = "none";
          emptyState.style.display = "block";
        } else {
          momentsContainer.style.display = "block";
          emptyState.style.display = "none";
          momentsContainer.innerHTML = "";

          momenBesarList.forEach((momenBesar, index) => {
            const totalSubMoments = momenBesar.categories.reduce(
              (total, kategori) => total + kategori.subMoments.length,
              0
            );

            const momenBesarCard = document.createElement("div");
            momenBesarCard.className = "momen-besar-card fade-in";
            momenBesarCard.style.animationDelay = `${index * 0.1}s`;

            momenBesarCard.innerHTML = `
              <div class="momen-besar-header">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h4 class="momen-besar-title">${momenBesar.name}</h4>
                    <p class="momen-besar-meta">
                      ${
                        momenBesar.categories.length
                      } kategori  ${totalSubMoments} sub momen
                    </p>
                  </div>
                  <i id="momen-besar-icon-${
                    momenBesar.id
                  }" class="fas fa-chevron-down"></i>
                </div>
              </div>
              <div class="momen-besar-content" id="momen-besar-content-${
                momenBesar.id
              }" style="display: none;">
                ${
                  momenBesar.description
                    ? `<p class="mb-3">${momenBesar.description}</p>`
                    : ""
                }
                
                <div class="d-flex justify-content-end mb-3">
                  <button class="btn btn-sm btn-outline-primary me-2" onclick="openAddKategoriModal(${
                    momenBesar.id
                  })">
                    <i class="fas fa-plus me-1"></i>Tambah Kategori
                  </button>
                  <button class="btn btn-sm edit-btn me-2" onclick="editMomenBesar(${
                    momenBesar.id
                  })">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteMomenBesar(${
                    momenBesar.id
                  })">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
                
                <div class="kategori-list">
                  ${
                    momenBesar.categories.length > 0
                      ? momenBesar.categories
                          .map((kategori) => {
                            const kategoriTotal = kategori.subMoments.length;

                            return `
                      <div class="kategori-card">
                        <div class="kategori-header">
                          <div class="d-flex justify-content-between align-items-center">
                            <div>
                              <h5 class="kategori-title">${kategori.name}</h5>
                              <p class="kategori-meta">
                                ${kategoriTotal} sub momen
                              </p>
                            </div>
                            <i id="kategori-icon-${
                              kategori.id
                            }" class="fas fa-chevron-down"></i>
                          </div>
                        </div>
                        <div class="kategori-content" id="kategori-content-${
                          kategori.id
                        }" style="display: none;">
                          ${
                            kategori.description
                              ? `<p class="mb-2">${kategori.description}</p>`
                              : ""
                          }
                          
                          <div class="d-flex justify-content-between align-items-center mb-2">
                            <div></div>
                            <div>
                              <button class="btn btn-sm btn-outline-primary me-2" onclick="openAddSubMomenModal(${
                                momenBesar.id
                              }, ${kategori.id})">
                                <i class="fas fa-plus me-1"></i>Tambah Sub Momen
                              </button>
                              <button class="btn btn-sm edit-btn me-2" onclick="editKategori(${
                                momenBesar.id
                              }, ${kategori.id})">
                                <i class="fas fa-edit"></i>
                              </button>
                              <button class="btn btn-sm btn-outline-danger" onclick="deleteKategori(${
                                momenBesar.id
                              }, ${kategori.id})">
                                <i class="fas fa-trash"></i>
                              </button>
                            </div>
                          </div>
                          
                          <div class="sub-momen-list">
                            ${
                              kategori.subMoments.length > 0
                                ? kategori.subMoments
                                    .map((subMomen) => {
                                      const peopleNames = (
                                        subMomen.people || []
                                      ).map((personId) => {
                                        const person = peopleList.find(
                                          (p) => p.id === personId
                                        );
                                        return person ? person.name : "Unknown";
                                      });

                                      return `
                                <div class="sub-momen-item">
                                  <div class="sub-momen-content">
                                    <div class="sub-momen-info">
                                      <div class="sub-momen-name">
                                        ${subMomen.name}
                                      </div>
                                      <div class="sub-momen-date">Tanggal: ${formatDate(
                                        subMomen.date
                                      )}</div>
                                      ${
                                        subMomen.description
                                          ? `<div class="sub-momen-description mt-1"><small>${subMomen.description}</small></div>`
                                          : ""
                                      }
                                      ${
                                        peopleNames.length > 0
                                          ? `
                                        <div class="mt-1">
                                          <small class="text-muted">Dengan: ${peopleNames.join(
                                            ", "
                                          )}</small>
                                        </div>
                                      `
                                          : ""
                                      }
                                      ${
                                        subMomen.images &&
                                        subMomen.images.length > 0
                                          ? `
                                        <div class="mt-2">
                                          <div class="photo-gallery">
                                            ${subMomen.images
                                              .map(
                                                (image, idx) => `
                                              <img src="${image}" class="photo-thumbnail" onclick="viewPhoto('${image}')" alt="Foto ${
                                                  idx + 1
                                                }">
                                            `
                                              )
                                              .join("")}
                                          </div>
                                        </div>
                                      `
                                          : ""
                                      }
                                    </div>
                                    <div class="sub-momen-actions">
                                      <button class="btn btn-sm edit-btn" onclick="editSubMomen(${
                                        momenBesar.id
                                      }, ${kategori.id}, ${subMomen.id})">
                                        <i class="fas fa-edit"></i>
                                      </button>
                                      <button class="btn btn-sm btn-outline-danger" onclick="deleteSubMomen(${
                                        momenBesar.id
                                      }, ${kategori.id}, ${subMomen.id})">
                                        <i class="fas fa-times"></i>
                                      </button>
                                    </div>
                                  </div>
                                </div>
                              `;
                                    })
                                    .join("")
                                : `
                              <div class="text-center py-3 text-muted">
                                <p>Belum ada sub momen</p>
                              </div>
                            `
                            }
                          </div>
                        </div>
                      </div>
                    `;
                          })
                          .join("")
                      : `
                    <div class="text-center py-4 text-muted">
                      <p>Belum ada kategori</p>
                    </div>
                  `
                  }
                </div>
              </div>
            `;

            momentsContainer.appendChild(momenBesarCard);
          });
        }
      }

      // Update statistics
      function updateStats() {
        const totalMomenBesar = momenBesarList.length;
        let totalKategori = 0;
        let totalSubMomen = 0;

        momenBesarList.forEach((momenBesar) => {
          totalKategori += momenBesar.categories.length;
          momenBesar.categories.forEach((kategori) => {
            totalSubMomen += kategori.subMoments.length;
          });
        });

        totalMomenBesarEl.textContent = totalMomenBesar;
        totalKategoriEl.textContent = totalKategori;
        totalSubMomenEl.textContent = totalSubMomen;
      }

      // Helper functions
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
      }

      function saveToLocalStorage() {
        localStorage.setItem("momenBesarList", JSON.stringify(momenBesarList));
        localStorage.setItem("peopleList", JSON.stringify(peopleList));
      }

      function showSuccess(message) {
        document.getElementById("successMessage").textContent = message;
        new bootstrap.Modal(document.getElementById("successModal")).show();
      }

      function createConfetti() {
        const colors = ["#2c3e50", "#3498db", "#e74c3c", "#27ae60", "#9b59b6"];
        for (let i = 0; i < 50; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "vw";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = Math.random() * 10 + 5 + "px";
          confetti.style.animationDelay = Math.random() * 5 + "s";
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 5000);
        }
      }
    </script>
  </body>
</html>
